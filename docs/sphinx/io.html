<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>IO in libSkylark &mdash; libSkylark  documentation</title>
    
    <link rel="stylesheet" href="_static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="libSkylark  documentation" href="index.html" />
    <link rel="next" title="Contributing" href="contributing.html" />
    <link rel="prev" title="Machine Learning" href="ml.html" /> 
  </head>
  <body role="document">
      <div class="header" role="banner"><h1 class="heading"><a href="index.html">
          <span>libSkylark  documentation</span></a></h1>
        <h2 class="heading"><span>IO in libSkylark</span></h2>
      </div>
      <div class="topnav" role="navigation" aria-label="top navigation">
      
        <p>
        «&#160;&#160;<a href="ml.html">Machine Learning</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="contributing.html">Contributing</a>&#160;&#160;»
        </p>

      </div>
      <div class="content">
        
        
  <div class="section" id="io-in-libskylark">
<h1>IO in libSkylark<a class="headerlink" href="#io-in-libskylark" title="Permalink to this headline">¶</a></h1>
<div class="section" id="io-from-c">
<h2>IO from C++<a class="headerlink" href="#io-from-c" title="Permalink to this headline">¶</a></h2>
<p>Currently, IO from the C++ layer is implemented in libskylark/ml/io.hpp.</p>
<div class="section" id="reading">
<h3>Reading<a class="headerlink" href="#reading" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="_CPP4readRKN5boost3mpi12communicatorEiNSt6stringER9InputTypeR9LabelTypei">
void <code class="descclassname"></code><code class="descname">read</code><span class="sig-paren">(</span><em class="property">const</em> boost::mpi::communicator &amp;<em>comm</em>, int <em>fileformat</em>, std::string <em>filename</em>, InputType &amp;<em>X</em>, LabelType &amp;<em>Y</em>, int <em>d</em> = 0<span class="sig-paren">)</span><a class="headerlink" href="#_CPP4readRKN5boost3mpi12communicatorEiNSt6stringER9InputTypeR9LabelTypei" title="Permalink to this definition">¶</a></dt>
<dd><p>Reads data from <cite>filename</cite> as a pair of matrices <cite>X</cite> and <cite>Y</cite>. Data are in the form of instances each carrying a label; an instance in turn consists of a series of feature/value pairs. Feature/value pairs are the column indices/entries for matrix <cite>X</cite> with its row indices coming from a running index of the instances (the minimum number of features is <cite>d</cite>). Matrix <cite>Y</cite> carries the vector of successive labels corresponding to this running index. <cite>fileformat</cite> can have any of the following values of <cite>FileFormatType</cite> enum (as defined in libskylark/ml/options.hpp):</p>
<ul class="simple">
<li>HDF5_DENSE</li>
<li>HDF5_SPARSE</li>
<li>LIBSVM_DENSE</li>
<li>LIBSVM_SPARSE</li>
</ul>
</dd></dl>

<p><cite>*_DENSE</cite> correspond to the case of elem::Matrix&lt;T&gt; (dense) matrix <cite>X</cite>; <cite>*_SPARSE</cite> is for the skylark::base::sparse_matrix_t&lt;T&gt; (sparse) matrix <cite>X</cite>.
<cite>HDF5_*</cite> are for <a class="reference external" href="http://www.hdfgroup.org/HDF5/">Hierarchical Data Format, version 5 (HDF5)</a> files  while <cite>LIBSVM_*</cite> are for <a class="reference external" href="http://www.csie.ntu.edu.tw/~cjlin/libsvm/">Library for Support Vector Machines (LIBSVM)</a> ones.</p>
<p><strong>HDF5-specific routines</strong></p>
<dl class="function">
<dt id="_CPP9read_hdf5RKN5boost3mpi12communicatorENSt6stringERN4elem6MatrixIdEERN4elem6MatrixIdEEi">
void <code class="descclassname"></code><code class="descname">read_hdf5</code><span class="sig-paren">(</span><em class="property">const</em> boost::mpi::communicator &amp;<em>comm</em>, std::string <em>filename</em>, elem::Matrix&lt;double&gt; &amp;<em>X</em>, elem::Matrix&lt;double&gt; &amp;<em>Y</em>, int <em>blocksize</em> = 10000<span class="sig-paren">)</span><a class="headerlink" href="#_CPP9read_hdf5RKN5boost3mpi12communicatorENSt6stringERN4elem6MatrixIdEERN4elem6MatrixIdEEi" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="_CPP9read_hdf5RKN5boost3mpi12communicatorENSt6stringERN7skylark4base15sparse_matrix_tIdEERN4elem6MatrixIdEEi">
void <code class="descclassname"></code><code class="descname">read_hdf5</code><span class="sig-paren">(</span><em class="property">const</em> boost::mpi::communicator &amp;<em>comm</em>, std::string <em>filename</em>, skylark::base::sparse_matrix_t&lt;double&gt; &amp;<em>X</em>, elem::Matrix&lt;double&gt; &amp;<em>Y</em>, int <em>min_d</em> = 0<span class="sig-paren">)</span><a class="headerlink" href="#_CPP9read_hdf5RKN5boost3mpi12communicatorENSt6stringERN7skylark4base15sparse_matrix_tIdEERN4elem6MatrixIdEEi" title="Permalink to this definition">¶</a></dt>
<dd><p>Reads datasets <cite>X</cite> and <cite>Y</cite> from HDF5 <cite>filename</cite> as a pair of matrices <cite>X</cite>, <cite>Y</cite>. Instances are read in bunches of <cite>blocksize</cite> each; <cite>min_d</cite> is the minimum number of features.</p>
</dd></dl>

<p><strong>LIBSVM-specific routines</strong></p>
<dl class="function">
<dt id="_CPP11read_libsvmRKN5boost3mpi12communicatorENSt6stringERN4elem6MatrixI1TEERN4elem6MatrixI1TEEii">
void <code class="descclassname"></code><code class="descname">read_libsvm</code><span class="sig-paren">(</span><em class="property">const</em> boost::mpi::communicator &amp;<em>comm</em>, std::string <em>filename</em>, elem::Matrix&lt;T&gt; &amp;<em>X</em>, elem::Matrix&lt;T&gt; &amp;<em>Y</em>, int <em>min_d</em> = 0, int <em>blocksize</em> = 10000<span class="sig-paren">)</span><a class="headerlink" href="#_CPP11read_libsvmRKN5boost3mpi12communicatorENSt6stringERN4elem6MatrixI1TEERN4elem6MatrixI1TEEii" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="_CPP11read_libsvmRKN5boost3mpi12communicatorENSt6stringERN7skylark4base15sparse_matrix_tI1TEERN4elem6MatrixI1TEEi">
void <code class="descclassname"></code><code class="descname">read_libsvm</code><span class="sig-paren">(</span><em class="property">const</em> boost::mpi::communicator &amp;<em>comm</em>, std::string <em>filename</em>, skylark::base::sparse_matrix_t&lt;T&gt; &amp;<em>X</em>, elem::Matrix&lt;T&gt; &amp;<em>Y</em>, int <em>min_d</em> = 0<span class="sig-paren">)</span><a class="headerlink" href="#_CPP11read_libsvmRKN5boost3mpi12communicatorENSt6stringERN7skylark4base15sparse_matrix_tI1TEERN4elem6MatrixI1TEEi" title="Permalink to this definition">¶</a></dt>
<dd><p>Reads data from LIBSVM <cite>filename</cite> as a pair of matrices <cite>X</cite>, <cite>Y</cite>. Instances are read in bunches of <cite>blocksize</cite> each; <cite>min_d</cite> is the minimum number of features.</p>
</dd></dl>

<p><strong>Utility routines</strong></p>
<dl class="function">
<dt id="_CPP17read_hdf5_datasetRN2H56H5FileENSt6stringEPiii">
void <code class="descclassname"></code><code class="descname">read_hdf5_dataset</code><span class="sig-paren">(</span>H5::H5File &amp;<em>file</em>, std::string <em>name</em>, int *<em>buffer</em>, int <em>offset</em>, int <em>count</em><span class="sig-paren">)</span><a class="headerlink" href="#_CPP17read_hdf5_datasetRN2H56H5FileENSt6stringEPiii" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="_CPP17read_hdf5_datasetRN2H56H5FileENSt6stringEPdii">
void <code class="descclassname"></code><code class="descname">read_hdf5_dataset</code><span class="sig-paren">(</span>H5::H5File &amp;<em>file</em>, std::string <em>name</em>, double *<em>buffer</em>, int <em>offset</em>, int <em>count</em><span class="sig-paren">)</span><a class="headerlink" href="#_CPP17read_hdf5_datasetRN2H56H5FileENSt6stringEPdii" title="Permalink to this definition">¶</a></dt>
<dd><p>Reads <cite>count</cite> entries from the <cite>name</cite> dataset in HDF5 <cite>file</cite> starting at <cite>offset</cite> and collects them into <cite>buffer</cite>.</p>
</dd></dl>

<dl class="function">
<dt id="_CPP15read_model_fileNSt6stringERN4elem6MatrixIdEE">
void <code class="descclassname"></code><code class="descname">read_model_file</code><span class="sig-paren">(</span>std::string <em>filename</em>, elem::Matrix&lt;double&gt; &amp;<em>W</em><span class="sig-paren">)</span><a class="headerlink" href="#_CPP15read_model_fileNSt6stringERN4elem6MatrixIdEE" title="Permalink to this definition">¶</a></dt>
<dd><p>Reads the values from model file <cite>filename</cite> into matrix <cite>W</cite>; model file is expected to start with a line of the form:
<cite># Dimensions m n</cite> for an <cite>m x n</cite> matrix <cite>W</cite> followed by lines containing the values of successive rows of the matrix.</p>
</dd></dl>

<dl class="function">
<dt id="_CPP11read_headerRKN5boost3mpi12communicatorENSt6stringE">
std::string <code class="descclassname"></code><code class="descname">read_header</code><span class="sig-paren">(</span><em class="property">const</em> boost::mpi::communicator &amp;<em>comm</em>, std::string <em>filename</em><span class="sig-paren">)</span><a class="headerlink" href="#_CPP11read_headerRKN5boost3mpi12communicatorENSt6stringE" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the first line of <cite>filename</cite>.</p>
</dd></dl>

</div>
<div class="section" id="writing">
<h3>Writing<a class="headerlink" href="#writing" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="_CPP10write_hdf5RKN5boost3mpi12communicatorENSt6stringERN4elem6MatrixIdEERN4elem6MatrixIdEE">
int <code class="descclassname"></code><code class="descname">write_hdf5</code><span class="sig-paren">(</span><em class="property">const</em> boost::mpi::communicator &amp;<em>comm</em>, std::string <em>filename</em>, elem::Matrix&lt;double&gt; &amp;<em>X</em>, elem::Matrix&lt;double&gt; &amp;<em>Y</em><span class="sig-paren">)</span><a class="headerlink" href="#_CPP10write_hdf5RKN5boost3mpi12communicatorENSt6stringERN4elem6MatrixIdEERN4elem6MatrixIdEE" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="_CPP10write_hdf5NSt6stringERN7skylark4base15sparse_matrix_tIdEERN4elem6MatrixIdEE">
int <code class="descclassname"></code><code class="descname">write_hdf5</code><span class="sig-paren">(</span>std::string <em>filename</em>, skylark::base::sparse_matrix_t&lt;double&gt; &amp;<em>X</em>, elem::Matrix&lt;double&gt; &amp;<em>Y</em><span class="sig-paren">)</span><a class="headerlink" href="#_CPP10write_hdf5NSt6stringERN7skylark4base15sparse_matrix_tIdEERN4elem6MatrixIdEE" title="Permalink to this definition">¶</a></dt>
<dd><p>Writes feature/value pairs (in matrix <cite>X</cite>) and labels (in matrix <cite>Y</cite>) to the HDF5 <cite>filename</cite> and returns 0 to signal successfully completed operation.</p>
<blockquote>
<div><ul class="simple">
<li>For the case of dense matrix input <cite>X</cite> (elem::Matrix&lt;double&gt; type) 2 datasets named <cite>X</cite> and <cite>Y</cite> are created in the file for all data.</li>
<li>For the case of sparse matrix <cite>X</cite> (skylark::base::sparse_matrix_t&lt;double&gt; type) 5 datasets are created in the file for all data: <cite>dimensions</cite> (for <cite>X</cite> matrix size), <cite>indptr</cite>, <cite>indices</cite>, <cite>values</cite> (for <cite>X</cite> matrix) and <cite>Y</cite> (for <cite>Y</cite> matrix).</li>
</ul>
</div></blockquote>
</dd></dl>

<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Currently IO from C++ and Python layers are not in sync; we expect a convergence of offerings from these layers as depending libraries (most notably Elemental) freeze their IO facilities and typical/common application IO scenaria are clearly identified.</p>
</div>
</div>
</div>
<div class="section" id="module-skylark.io">
<span id="io-from-python"></span><h2>IO from Python<a class="headerlink" href="#module-skylark.io" title="Permalink to this headline">¶</a></h2>
<p>IO facilities.</p>
<dl class="docutils">
<dt>The following data formats are supported:</dt>
<dd><ul class="first last simple">
<li>Hierarchical Data Format (HDF5)             : <code class="docutils literal"><span class="pre">hdf5</span></code> class</li>
<li>Matrix Market exchange format               : <code class="docutils literal"><span class="pre">mtx</span></code> class</li>
<li>Library for Supprort Vector Machines format : <code class="docutils literal"><span class="pre">libsvm</span></code> class</li>
<li>Raw text format                             : <code class="docutils literal"><span class="pre">txt</span></code> class</li>
</ul>
</dd>
<dt>Three operations are exported, as appropriate:</dt>
<dd><ul class="first last simple">
<li><code class="docutils literal"><span class="pre">read()</span></code></li>
<li><code class="docutils literal"><span class="pre">write()</span></code></li>
<li><code class="docutils literal"><span class="pre">stream()</span></code></li>
</ul>
</dd>
</dl>
<p>In all cases the constructor has as its first argument the filepath where the
data is (or is expected to be) for the operation to complete and as a last
argument a boolean flag for whether the operation will use parallel IO or
not.</p>
<p><code class="docutils literal"><span class="pre">read()</span></code> is typically provided the <code class="docutils literal"><span class="pre">matrix_type</span></code> of the object to load in memory
as its first argument. <code class="docutils literal"><span class="pre">write()</span></code> gets the matrix object itself as its only
argument.</p>
<dl class="docutils">
<dt>Matrix types are identified with string identifiers that are self-explanatory:</dt>
<dd><ul class="first last simple">
<li><code class="docutils literal"><span class="pre">'numpy-dense'</span></code></li>
<li><code class="docutils literal"><span class="pre">'elemental-dense'</span></code></li>
<li><code class="docutils literal"><span class="pre">'scipy-sparse'</span></code></li>
<li><code class="docutils literal"><span class="pre">'combblas-sparse'</span></code></li>
</ul>
</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Parallel IO is experimental.</p>
</div>
<dl class="function">
<dt id="skylark.io._usage_tests">
<code class="descclassname">skylark.io.</code><code class="descname">_usage_tests</code><span class="sig-paren">(</span><em>usps_path='./datasets/usps.t'</em><span class="sig-paren">)</span><a class="headerlink" href="#skylark.io._usage_tests" title="Permalink to this definition">¶</a></dt>
<dd><p>Various simple example scenaria for showing the usage of the IO facilities</p>
</dd></dl>

<dl class="class">
<dt id="skylark.io.elemental_dense">
<em class="property">class </em><code class="descclassname">skylark.io.</code><code class="descname">elemental_dense</code><a class="headerlink" href="#skylark.io.elemental_dense" title="Permalink to this definition">¶</a></dt>
<dd><p>Utility functions for <code class="docutils literal"><span class="pre">'elemental-dense'</span></code> matrices.</p>
<dl class="classmethod">
<dt id="skylark.io.elemental_dense.get_constructor">
<em class="property">classmethod </em><code class="descname">get_constructor</code><span class="sig-paren">(</span><em>distribution='MC_MR'</em><span class="sig-paren">)</span><a class="headerlink" href="#skylark.io.elemental_dense.get_constructor" title="Permalink to this definition">¶</a></dt>
<dd><p>Constructor for a matrix distribution.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>distribution</strong> : string</p>
<blockquote>
<div><p>String identifier of matrix distribution.</p>
</div></blockquote>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>constructor</strong> : object</p>
<blockquote class="last">
<div><p>Constructor; <code class="docutils literal"><span class="pre">constructor()</span></code> will instantiate the matrix.</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="classmethod">
<dt id="skylark.io.elemental_dense.get_distribution">
<em class="property">classmethod </em><code class="descname">get_distribution</code><span class="sig-paren">(</span><em>A</em><span class="sig-paren">)</span><a class="headerlink" href="#skylark.io.elemental_dense.get_distribution" title="Permalink to this definition">¶</a></dt>
<dd><p>String identifier of matrix distribution.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>A</strong> : <code class="docutils literal"><span class="pre">'elemental-dense'</span></code> matrix</p>
<blockquote>
<div><p>Input matrix.</p>
</div></blockquote>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>distribution</strong> : string</p>
<blockquote class="last">
<div><p>String identifier of matrix distribution.</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="classmethod">
<dt id="skylark.io.elemental_dense.get_indices">
<em class="property">classmethod </em><code class="descname">get_indices</code><span class="sig-paren">(</span><em>A</em><span class="sig-paren">)</span><a class="headerlink" href="#skylark.io.elemental_dense.get_indices" title="Permalink to this definition">¶</a></dt>
<dd><p>Matrix indices.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>A</strong> : <code class="docutils literal"><span class="pre">'elemental-dense'</span></code> matrix</p>
<blockquote>
<div><p>Input matrix.</p>
</div></blockquote>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>indices</strong> : list of integers</p>
<blockquote class="last">
<div><p>Global indices into the the vector of entries of matrix A that are
locally hosted if the matrix is traversed in column-major mode.</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="skylark.io.hdf5">
<em class="property">class </em><code class="descclassname">skylark.io.</code><code class="descname">hdf5</code><span class="sig-paren">(</span><em>fpath</em>, <em>dataset='data'</em>, <em>parallel=False</em>, <em>atomic=False</em><span class="sig-paren">)</span><a class="headerlink" href="#skylark.io.hdf5" title="Permalink to this definition">¶</a></dt>
<dd><p>IO support for HDF5.</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">read()</span></code> can load as <code class="docutils literal"><span class="pre">'elemental-dense'</span></code> and <code class="docutils literal"><span class="pre">'numpy-dense'</span></code> matrix types;
for <code class="docutils literal"><span class="pre">'elemental-dense'</span></code>, data <code class="docutils literal"><span class="pre">distribution</span></code> should also be indicated.</li>
<li><code class="docutils literal"><span class="pre">write()</span></code> can save <code class="docutils literal"><span class="pre">'elemental-dense'</span></code> and <code class="docutils literal"><span class="pre">'numpy-dense'</span></code> matrix types.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>Parallel IO requires a parallel-enabled build of the <code class="docutils literal"><span class="pre">HDF5</span></code>
library followed by compilation of <code class="docutils literal"><span class="pre">h5py</span></code> python bindings in MPI
mode. These steps are detailed in
<a class="reference external" href="http://www.h5py.org/docs/topics/mpi.html">http://www.h5py.org/docs/topics/mpi.html</a>.</li>
<li>Parallel IO reads and writes matrix data in vectorized layout
(column-major). The shape of the matrix is expected separately in
<code class="docutils literal"><span class="pre">'shape'</span></code> dataset.</li>
</ul>
</div>
<dl class="method">
<dt id="skylark.io.hdf5.read">
<code class="descname">read</code><span class="sig-paren">(</span><em>matrix_type='elemental-dense'</em>, <em>distribution='MC_MR'</em><span class="sig-paren">)</span><a class="headerlink" href="#skylark.io.hdf5.read" title="Permalink to this definition">¶</a></dt>
<dd><p>Read dataset from an HDF5 file as a matrix.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>matrix_type</strong> : string, optional</p>
<blockquote>
<div><p>String identifier for the matrix object that is read in. Two options
are available:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal"><span class="pre">'elemental-dense'</span></code> for DistMatrix&lt;double,...&gt; objects in Elemental
library as wrapped in python (default).</li>
<li><code class="docutils literal"><span class="pre">'numpy-dense'</span></code> for array objects in numpy package.</li>
</ul>
</div></blockquote>
</div></blockquote>
<p><strong>distribution</strong> : string, optional</p>
<blockquote>
<div><p>String identifier for the matrix data distribution for the case the
input matrix is required to be of <code class="docutils literal"><span class="pre">'elemental-dense'</span></code> type; this argument
is ignored in the <code class="docutils literal"><span class="pre">'numpy-dense'</span></code> case. Available options are:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal"><span class="pre">'MC_MR'</span></code> (default)</li>
<li><code class="docutils literal"><span class="pre">'VC_STAR'</span></code></li>
<li><code class="docutils literal"><span class="pre">'VR_STAR'</span></code></li>
<li><code class="docutils literal"><span class="pre">'STAR_VC'</span></code></li>
<li><code class="docutils literal"><span class="pre">'STAR_VR'</span></code></li>
</ul>
</div></blockquote>
</div></blockquote>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>matrix</strong> : Python-wrapped DistMatrix&lt;double,...&gt; or numpy array</p>
<blockquote class="last">
<div><p>Matrix read.</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="skylark.io.hdf5.write">
<code class="descname">write</code><span class="sig-paren">(</span><em>A</em><span class="sig-paren">)</span><a class="headerlink" href="#skylark.io.hdf5.write" title="Permalink to this definition">¶</a></dt>
<dd><p>Write matrix as a dataset to an HDF5 file.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>A</strong> : Python-wrapped DistMatrix&lt;double,...&gt; or numpy array</p>
<blockquote>
<div><p>Matrix to write.</p>
</div></blockquote>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><strong>None</strong> :</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="skylark.io.libsvm">
<em class="property">class </em><code class="descclassname">skylark.io.</code><code class="descname">libsvm</code><span class="sig-paren">(</span><em>fpath</em>, <em>parallel=False</em><span class="sig-paren">)</span><a class="headerlink" href="#skylark.io.libsvm" title="Permalink to this definition">¶</a></dt>
<dd><p>IO support for libsvm.</p>
<p>A libsvm file for our purposes consists of lines. Each line corresponds to
an instance: this starts with a <em>label</em> (the class label of the instance)
and it is followed by the set of its <em>feature</em>/<em>value</em> pairs.</p>
<p><code class="docutils literal"><span class="pre">read()</span></code> and <code class="docutils literal"><span class="pre">stream()</span></code> operations are supported that produce
(sparse-matrix, vector) pairs. The sparse matrix uses the <em>features</em> as
column indices, the <em>values</em> as matrix entries and a running <em>index</em> of
the instances as row indices. The vector accumulates the <em>labels</em>.</p>
<dl class="docutils">
<dt>So there are four vectors expected from the parsing stage:</dt>
<dd><ul class="first last simple">
<li><em>labels</em></li>
<li><em>indices</em></li>
<li><em>features</em></li>
<li><em>values</em></li>
</ul>
</dd>
</dl>
<p>and these are returned from <code class="docutils literal"><span class="pre">read_vectors()</span></code> and <code class="docutils literal"><span class="pre">stream_vectors()</span></code>
methods (<code class="docutils literal"><span class="pre">vectors_to_matrices()</span></code> provides the conversion).</p>
<p>In streaming, the file is not read in one shot (as it happens e.g. in
<code class="docutils literal"><span class="pre">read()</span></code>), but in stages: each stage consumes the next <code class="docutils literal"><span class="pre">block_size</span></code>
instances (i.e lines) in the input file (or the number of lines left,
whichever happens to be smallest), thus dramatically bounding overall memory
requirements.</p>
<dl class="method">
<dt id="skylark.io.libsvm.read">
<code class="descname">read</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#skylark.io.libsvm.read" title="Permalink to this definition">¶</a></dt>
<dd><p>Read the (features matrix, labels vector) pair from a libsvm file.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>None</strong> :</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>matrix</strong> : scipy sparse array</p>
<blockquote>
<div><p>Features matrix read.</p>
</div></blockquote>
<p><strong>vector</strong> : numpy array</p>
<blockquote class="last">
<div><p>Labels vector read.</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="skylark.io.libsvm.read_vectors">
<code class="descname">read_vectors</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#skylark.io.libsvm.read_vectors" title="Permalink to this definition">¶</a></dt>
<dd><p>Read the labels, indices, features and values from a libsvm file as a
tuple of vectors.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>None</strong> :</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>labels</strong> : list of integers</p>
<blockquote>
<div><p>Class labels of instances.</p>
</div></blockquote>
<p><strong>indices</strong> : list of integers</p>
<blockquote>
<div><p>Row indices of features/values in their sparse matrix representation.</p>
</div></blockquote>
<p><strong>features</strong> : list of integers</p>
<blockquote>
<div><p>Column indices of fetures/values in their sparse matrix</p>
</div></blockquote>
<p><strong>representation.</strong> :</p>
<p><strong>values</strong> : list of floats</p>
<blockquote class="last">
<div><p>Sparse matrix entries; values for features.</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="skylark.io.libsvm.stream">
<code class="descname">stream</code><span class="sig-paren">(</span><em>num_features</em>, <em>block_size=1000</em><span class="sig-paren">)</span><a class="headerlink" href="#skylark.io.libsvm.stream" title="Permalink to this definition">¶</a></dt>
<dd><p>Stream the (features matrix, labels vector) pair from a libsvm file.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>num_features</strong> : int</p>
<blockquote>
<div><p>Number of features.</p>
</div></blockquote>
<p><strong>block_size</strong> : int, optional</p>
<blockquote>
<div><p>Number of lines to parse in each iteration.</p>
</div></blockquote>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>generator</strong> :</p>
<blockquote class="last">
<div><p>A function that behaves like an iterator over the libsvm parts (of
<cite>block_size</cite> lines max each).</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="skylark.io.libsvm.stream_vectors">
<code class="descname">stream_vectors</code><span class="sig-paren">(</span><em>block_size=1000</em>, <em>type=1</em><span class="sig-paren">)</span><a class="headerlink" href="#skylark.io.libsvm.stream_vectors" title="Permalink to this definition">¶</a></dt>
<dd><p>Stream the labels, indices, features and values from a libsvm file as a
tuple of vectors.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>block_size</strong> : int, optional</p>
<blockquote>
<div><p>Number of lines to parse in each iteration.</p>
</div></blockquote>
<p><strong>type</strong> : int, optional</p>
<blockquote>
<div><p>1 (default): &#8220;i-j-v&#8221; triplets
0: indices are actually pointers into feature/values array as used in CRS/CSC</p>
</div></blockquote>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>generator</strong> :</p>
<blockquote>
<div><p>A function that behaves like an iterator over the tuples of vectors for</p>
</div></blockquote>
<p class="last"><strong>the libsvm parts (of ``block_size`` lines max each).</strong> :</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="skylark.io.libsvm.vectors_to_matrices">
<code class="descname">vectors_to_matrices</code><span class="sig-paren">(</span><em>vectors</em>, <em>num_features=0</em><span class="sig-paren">)</span><a class="headerlink" href="#skylark.io.libsvm.vectors_to_matrices" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>vectors</strong> : tuple of lists</p>
<blockquote>
<div><p>(labels, indices, features, values); see <code class="docutils literal"><span class="pre">read_vector()</span></code> for
decriptions.</p>
</div></blockquote>
<p><strong>num_features</strong> : int, optional</p>
<blockquote>
<div><p>Number of features.</p>
</div></blockquote>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>generator</strong> :</p>
<blockquote class="last">
<div><p>A function that behaves like an iterator over the libsvm parts (of
<code class="docutils literal"><span class="pre">block_size</span></code> lines max each).</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="skylark.io.mtx">
<em class="property">class </em><code class="descclassname">skylark.io.</code><code class="descname">mtx</code><span class="sig-paren">(</span><em>fpath</em>, <em>layout='coordinate'</em>, <em>parallel=False</em><span class="sig-paren">)</span><a class="headerlink" href="#skylark.io.mtx" title="Permalink to this definition">¶</a></dt>
<dd><p>IO support for Matrix Market exchange format (MM).</p>
<p>The <code class="docutils literal"><span class="pre">layout</span></code> of the data to is expected to be in <code class="docutils literal"><span class="pre">'coordinate'</span></code> or
<code class="docutils literal"><span class="pre">'array'</span></code> MM formats.</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal"><span class="pre">read()</span></code> can load <code class="docutils literal"><span class="pre">'numpy-dense'</span></code>, <code class="docutils literal"><span class="pre">'scipy-sparse'</span></code> and
<code class="docutils literal"><span class="pre">'combblas-sparse'</span></code> matrix types from <code class="docutils literal"><span class="pre">'coordinate'</span></code> MM format and
<code class="docutils literal"><span class="pre">'numpy-dense'</span></code>, <code class="docutils literal"><span class="pre">'scipy-sparse'</span></code> from <code class="docutils literal"><span class="pre">'array'</span></code> MM format.</li>
<li><code class="docutils literal"><span class="pre">write()</span></code> can save in <code class="docutils literal"><span class="pre">'array'</span></code> and <code class="docutils literal"><span class="pre">'coordinate'</span></code> MM formats from
<code class="docutils literal"><span class="pre">'numpy-dense'</span></code> and in <code class="docutils literal"><span class="pre">'coordinate'</span></code> MM format from
<code class="docutils literal"><span class="pre">'scipy-sparse'</span></code> and <code class="docutils literal"><span class="pre">'combblas-sparse'</span></code> matrix types.</li>
</ul>
</div></blockquote>
<dl class="method">
<dt id="skylark.io.mtx.read">
<code class="descname">read</code><span class="sig-paren">(</span><em>matrix_type='scipy-sparse'</em><span class="sig-paren">)</span><a class="headerlink" href="#skylark.io.mtx.read" title="Permalink to this definition">¶</a></dt>
<dd><p>Read a matrix from an MM file.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>matrix_type</strong> : string, optional</p>
<blockquote>
<div><p>String identifier for the matrix object that is read in. Three options
are available:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal"><span class="pre">'numpy-dense'</span></code> for array objects in numpy package.</li>
<li><code class="docutils literal"><span class="pre">'scipy-sparse'</span></code> for sparse array objects in scipy package,
of type <cite>scipy.sparse.csr_matrix</cite> (default).</li>
<li><code class="docutils literal"><span class="pre">'combblas-sparse'</span></code> for array objects in CombBLAS wrapped as python
objects of <cite>kdt.Mat</cite> type.</li>
</ul>
</div></blockquote>
</div></blockquote>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>matrix</strong> : numpy array or scipy sparse array or CombBLAS kdt.Mat matrix</p>
<blockquote class="last">
<div><p>Matrix read.</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="skylark.io.mtx.write">
<code class="descname">write</code><span class="sig-paren">(</span><em>A</em><span class="sig-paren">)</span><a class="headerlink" href="#skylark.io.mtx.write" title="Permalink to this definition">¶</a></dt>
<dd><p>Write matrix to an MM file.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>matrix</strong> : numpy array or scipy sparse array or CombBLAS kdt.Mat matrix</p>
<blockquote>
<div><p>Matrix to write.</p>
</div></blockquote>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><strong>None</strong> :</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="skylark.io.txt">
<em class="property">class </em><code class="descclassname">skylark.io.</code><code class="descname">txt</code><span class="sig-paren">(</span><em>fpath</em>, <em>parallel=False</em><span class="sig-paren">)</span><a class="headerlink" href="#skylark.io.txt" title="Permalink to this definition">¶</a></dt>
<dd><p>IO support for raw text format.</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">read()</span></code> can load as <code class="docutils literal"><span class="pre">'numpy-dense'</span></code> matrix type.</li>
<li><code class="docutils literal"><span class="pre">write()</span></code> can save <code class="docutils literal"><span class="pre">'elemental-dense'</span></code> and <code class="docutils literal"><span class="pre">'numpy-dense'</span></code> matrix types.</li>
</ul>
<dl class="method">
<dt id="skylark.io.txt.read">
<code class="descname">read</code><span class="sig-paren">(</span><em>matrix_type='numpy-dense'</em><span class="sig-paren">)</span><a class="headerlink" href="#skylark.io.txt.read" title="Permalink to this definition">¶</a></dt>
<dd><p>Read dataset from an raw text file as a matrix.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>matrix_type</strong> : string, optional</p>
<blockquote class="last">
<div><dl class="docutils">
<dt>String identifier for the matrix object that is read in. One option</dt>
<dd><ul class="first last simple">
<li><code class="docutils literal"><span class="pre">'numpy-dense'</span></code> for array objects in numpy package (default).</li>
</ul>
</dd>
</dl>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="skylark.io.txt.write">
<code class="descname">write</code><span class="sig-paren">(</span><em>A</em><span class="sig-paren">)</span><a class="headerlink" href="#skylark.io.txt.write" title="Permalink to this definition">¶</a></dt>
<dd><p>Write matrix in raw text format.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>A</strong> : Python-wrapped DistMatrix&lt;double,...&gt; or numpy array</p>
<blockquote>
<div><p>Matrix to write.</p>
</div></blockquote>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><strong>None</strong> :</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<div class="section" id="example">
<h3>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#!/usr/bin/env python</span>

<span class="c"># prevent mpi4py from calling MPI_Finalize()</span>
<span class="kn">import</span> <span class="nn">mpi4py.rc</span>
<span class="n">mpi4py</span><span class="o">.</span><span class="n">rc</span><span class="o">.</span><span class="n">finalize</span>   <span class="o">=</span> <span class="bp">False</span>

<span class="kn">import</span> <span class="nn">h5py</span>
<span class="kn">import</span> <span class="nn">elem</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">numpy.linalg</span>
<span class="kn">from</span> <span class="nn">mpi4py</span> <span class="kn">import</span> <span class="n">MPI</span>
<span class="kn">import</span> <span class="nn">skylark</span><span class="o">,</span> <span class="nn">skylark.io</span>

<span class="n">comm</span> <span class="o">=</span> <span class="n">MPI</span><span class="o">.</span><span class="n">COMM_WORLD</span>

<span class="c"># Create a HDF5 file and encapsulate this and its metadata in store</span>
<span class="n">filename</span> <span class="o">=</span> <span class="s">&#39;mydataset.hdf5&#39;</span> 
<span class="n">store</span> <span class="o">=</span> <span class="n">skylark</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">hdf5</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">dataset</span><span class="o">=</span><span class="s">&#39;MyDataset&#39;</span><span class="p">)</span>

<span class="c"># Create a 5 x 10 dat matrix and populate its store</span>
<span class="k">if</span> <span class="n">comm</span><span class="o">.</span><span class="n">Get_rank</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
  <span class="n">m</span> <span class="o">=</span> <span class="mi">8</span>
  <span class="n">n</span> <span class="o">=</span> <span class="mi">10</span>
  <span class="n">matrix</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">81</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
  <span class="n">store</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">matrix</span><span class="p">)</span>
      
<span class="c"># Let all processes wait till the file is created.</span>
<span class="n">comm</span><span class="o">.</span><span class="n">barrier</span><span class="p">()</span>
    
<span class="c"># All processes read into the file</span>
<span class="n">A</span> <span class="o">=</span> <span class="n">store</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s">&#39;elemental-dense&#39;</span><span class="p">,</span> <span class="n">distribution</span><span class="o">=</span><span class="s">&#39;VC_STAR&#39;</span><span class="p">)</span>

<span class="c"># Check the Frobenius norm of the difference of generated/written and read-back matrices</span>
<span class="c"># Gather at root</span>
<span class="n">A_CIRC_CIRC</span> <span class="o">=</span> <span class="n">elem</span><span class="o">.</span><span class="n">DistMatrix_d_CIRC_CIRC</span><span class="p">()</span>
<span class="n">elem</span><span class="o">.</span><span class="n">Copy</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">A_CIRC_CIRC</span><span class="p">)</span>

<span class="c"># Compute the norm at root and output</span>
<span class="k">if</span> <span class="n">comm</span><span class="o">.</span><span class="n">rank</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
  <span class="n">diff_fro_norm</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">A_CIRC_CIRC</span><span class="o">.</span><span class="n">Matrix</span><span class="p">[:]</span> <span class="o">-</span> <span class="n">matrix</span><span class="p">,</span> <span class="nb">ord</span><span class="o">=</span><span class="s">&#39;fro&#39;</span><span class="p">)</span>
  <span class="k">print</span> <span class="s">&#39;||generated_matrix - read_matrix||_F = </span><span class="si">%f</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">diff_fro_norm</span> 
</pre></div>
</div>
</div>
</div>
<div class="section" id="sketch-serialization">
<h2>Sketch Serialization<a class="headerlink" href="#sketch-serialization" title="Permalink to this headline">¶</a></h2>
<p>As mentioned in Section <a class="reference internal" href="sketching.html#sketching-transforms-label"><em>Sketching Transforms</em></a> sketches can be
serialized using the following API:</p>
<dl class="function">
<dt id="_CPPK8to_ptreev">
boost::property_tree::ptree <code class="descclassname"></code><code class="descname">to_ptree</code><span class="sig-paren">(</span><span class="sig-paren">)</span> <em class="property">const</em><a class="headerlink" href="#_CPPK8to_ptreev" title="Permalink to this definition">¶</a></dt>
<dd><p>Serialize the sketch transform to a ptree structure.</p>
</dd></dl>

<dl class="function">
<dt id="_CPP10from_ptreeRKN5boost13property_tree5ptreeE">
<em class="property">static</em> sketch_transform_t *<code class="descclassname"></code><code class="descname">from_ptree</code><span class="sig-paren">(</span><em class="property">const</em> boost::property_tree::ptree &amp;<em>pt</em><span class="sig-paren">)</span><a class="headerlink" href="#_CPP10from_ptreeRKN5boost13property_tree5ptreeE" title="Permalink to this definition">¶</a></dt>
<dd><p>Load a sketch transform from a ptree structure.</p>
</dd></dl>

<p>The following small snippet shows how a sketch can be serialized and loaded in
C++.</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="c1">//[&gt; 1. Create the sketching matrix and dump JSON &lt;]</span>
<span class="n">skylark</span><span class="o">::</span><span class="n">sketch</span><span class="o">::</span><span class="n">CWT_t</span><span class="o">&lt;</span><span class="n">DistMatrixType</span><span class="p">,</span> <span class="n">DistMatrixType</span><span class="o">&gt;</span>
    <span class="n">Sparse</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">n_s</span><span class="p">,</span> <span class="n">context</span><span class="p">);</span>

<span class="c1">// dump to property tree</span>
<span class="n">boost</span><span class="o">::</span><span class="n">property_tree</span><span class="o">::</span><span class="n">ptree</span> <span class="n">pt</span> <span class="o">=</span> <span class="n">Sparse</span><span class="p">.</span><span class="n">get_data</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">to_ptree</span><span class="p">();</span>

<span class="c1">//[&gt; 2. Dump the JSON string to file &lt;]</span>
<span class="n">std</span><span class="o">::</span><span class="n">ofstream</span> <span class="n">out</span><span class="p">(</span><span class="s">&quot;sketch.json&quot;</span><span class="p">);</span>
<span class="n">write_json</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">pt</span><span class="p">);</span>
<span class="n">out</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>

<span class="c1">//[&gt; 3. Create a sketch from the JSON file. &lt;]</span>
<span class="n">std</span><span class="o">::</span><span class="n">ifstream</span> <span class="n">file</span><span class="p">;</span>
<span class="n">std</span><span class="o">::</span><span class="n">stringstream</span> <span class="n">json</span><span class="p">;</span>
<span class="n">file</span><span class="p">.</span><span class="n">open</span><span class="p">(</span><span class="s">&quot;sketch.json&quot;</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">ios</span><span class="o">::</span><span class="n">in</span><span class="p">);</span>

<span class="n">boost</span><span class="o">::</span><span class="n">property_tree</span><span class="o">::</span><span class="n">ptree</span> <span class="n">json_tree</span><span class="p">;</span>
<span class="n">boost</span><span class="o">::</span><span class="n">property_tree</span><span class="o">::</span><span class="n">read_json</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">json_tree</span><span class="p">);</span>

<span class="n">skylark</span><span class="o">::</span><span class="n">sketch</span><span class="o">::</span><span class="n">CWT_t</span><span class="o">&lt;</span><span class="n">DistMatrixType</span><span class="p">,</span> <span class="n">DistMatrixType</span><span class="o">&gt;</span> <span class="n">tmp</span><span class="p">(</span><span class="n">json_tree</span><span class="p">);</span>
</pre></div>
</div>
<p>This functionality is also exposed to the Python layer.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">S</span> <span class="o">=</span> <span class="n">sketch</span><span class="o">.</span><span class="n">CWT</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<span class="n">sketch_dict</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">serialize</span><span class="p">()</span>

<span class="n">S_clone</span> <span class="o">=</span> <span class="n">deserialize_sketch</span><span class="p">(</span><span class="n">sketch_dict</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>


      </div>
      <div class="bottomnav" role="navigation" aria-label="bottom navigation">
      
        <p>
        «&#160;&#160;<a href="ml.html">Machine Learning</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="contributing.html">Contributing</a>&#160;&#160;»
        </p>

      </div>

    <div class="footer" role="contentinfo">
        &copy; Copyright IBM Corporation 2012-2014.  All Rights Reserved.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3b1.
    </div>
  </body>
</html>